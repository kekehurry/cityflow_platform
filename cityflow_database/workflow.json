{"nodes": [{"type": "expand", "module": "builder", "version": "0.0.1", "config": {"type": "interface", "sessionID": "fDiCVhVPu10y0O_YuBBge", "author": "Kai Hu", "category": "gis", "title": "OSMDownloader", "input": [""], "output": ["amenities", "roads", "buildings"], "width": 250, "height": 130, "port": null, "language": "javascript", "description": "This module is useful for downloading POIs from open street map", "baseUrl": "", "secretKey": "", "model": "gpt-4o-mini", "packages": ["react", "@mui/material"], "code": {"interface": "\n//import packages from the scope\nimport {Typography,List,TextField,Checkbox ,Stack,FormControlLabel} from '@mui/material';\nimport {useEffect, useState} from 'react';\n\n// load necessary variables from the scope\nconst {input,config,setConfig,setOutput,setLoading} = props;\n\n// main function\n\nexport default function OSMDownloader(props) {\n    const [inputValue, setInputValue] = useState({\n        \"city\":config.city || \"\",\n        \"state\":config.state || \"\",\n        \"country\":config.country || \"\"\n    });\n    const [type, setType] = useState(\n        {\n        \"buildings\":config.buildings || false,\n        \"roads\":config.roads || false,\n        \"amenities\": config.amenities || true\n        }\n    );\n\n    const handleCheck = (e) => {\n        setType({...type, [e.target.id]: !type[e.target.id]});\n        setConfig({...config, [e.target.id]: !type[e.target.id]});\n    }\n\n    const handleValueChange = (e) => {\n        setInputValue({...inputValue, [e.target.id]: e.target.value});\n    }\n\n    const handleCommit = ()=>{\n        setConfig({...config,...inputValue})\n    }\n\n    const getElementQuery = () => {\n        let query = \"\";\n        if (type.buildings){\n            query += \"way(area.searchArea)[building];\";\n        }\n        if (type.roads){\n            query += \"way(area.searchArea)[highway];\";\n        }\n        if (type.amenities){\n            query += \"node(area.searchArea)[amenity];\";\n        }\n        return query;\n    }\n\n    const getOSMData = async () =>{\n        //geoCode use Nominatim API\n        const {city, state, country} = inputValue;\n        const location = [city, state, country].join(\"%2C\");\n        const geoCodeApi = `https://nominatim.openstreetmap.org/search?X-Requested-With=overpass-turbo&format=json&q=${location}`;\n        const locationData = await fetch(geoCodeApi).then(data => data.json());\n        const osmID = locationData[0]?.osm_id;\n        const osmType = locationData[0]?.osm_type;\n        if (!osmID || !osmType) {\n            console.error(\"Error: No valid OSM ID or Type found\");\n            return;\n        }\n        // console.log(\"GET OSM ID\", osmID);\n        //overpass API\n        const query = getElementQuery();\n        const overpassApi = \"https://overpass-api.de/api/interpreter\";\n\n        let areaID;\n        if (osmType === 'relation') {\n            areaID = 3600000000 + osmID;\n        } else {\n            console.error(\"OSM Type is not a relation, area query may not work directly.\");\n            return;\n        }\n        const osmQuery = `\n        [out:json];\n        area(${areaID})->.searchArea;\n        (${query});\n        out geom;\n        `;\n        const geoData = await fetch(\n            overpassApi,\n            {\n                method: \"POST\",\n                body: \"data=\"+ encodeURIComponent(osmQuery),\n            },)\n            .then(data=>data.json())\n            .then(jsonData=>jsonData[\"elements\"])\n            .then(jsonData=>parseOSMData(jsonData))\n            .catch(error => console.error(\"Error:\", error));\n        return geoData;\n    }\n\n    const parseOSMData = (jsonData) => {\n        const nodes = jsonData.filter(element => element.type === \"node\");\n        const ways = jsonData.filter(element => element.type === \"way\");\n\n        const amenities = {type: \"FeatureCollection\", features: []};\n        const roads = {type: \"FeatureCollection\", features: []};\n        const buildings = {type: \"FeatureCollection\", features: []};\n\n        nodes.forEach(node => {\n            amenities.features.push({\n                type: \"Feature\",\n                geometry: {\n                    type: \"Point\",\n                    coordinates: [node.lon, node.lat]\n                },\n                properties: {...node.tags, \"id\": node.id, \"type\": \"amenity\"}\n            })\n        });\n        \n        ways.forEach(way => {\n            const coordinates = way.geometry.map(node => [node.lon, node.lat]);\n            if (way.tags.building){\n                buildings.features.push({\n                    type: \"Feature\",\n                    geometry: {\n                        type: \"Polygon\",\n                        coordinates: [coordinates]\n                    },\n                    properties: {...way.tags, \"id\": way.id, \"type\": \"building\"}\n                });\n            }\n            if (way.tags.highway){\n                roads.features.push({\n                    type: \"Feature\",\n                    geometry: {\n                        type: \"LineString\",\n                        coordinates: coordinates\n                    },\n                    properties: {...way.tags, \"id\": way.id, \"type\": \"road\"}\n                });\n            }\n        });\n        let output = {};\n        if (amenities.features.length > 0) output[\"amenities\"] = amenities;\n        if (roads.features.length > 0) output[\"roads\"] = roads;\n        if (buildings.features.length > 0) output[\"buildings\"] = buildings;\n        return output;\n    }\n\n    useEffect(()=>{\n        if (!(config.run&&inputValue.city&&inputValue.state&&inputValue.country)){\n            setOutput({output:null});\n        }else{\n            setLoading(true)\n            getOSMData()\n            .then(geoData =>setOutput({...geoData}))\n        }\n    },[config.run,inputValue,type]);\n\n    return (\n        <List>\n            <Stack spacing={1} sx={{p:1}}>\n                <TextField id=\"city\" placeholder=\"City\" variant=\"outlined\" \n                        onChange={handleValueChange} \n                        onFocus={()=>setConfig({...config, run:false})}\n                        onMouseLeave = {handleCommit}\n                        value = {inputValue.city}\n                        size=\"small\"\n                        InputLabelProps={{style: { fontSize: 10 }}}\n                        InputProps={{style: { fontSize: 8 }}}\n                        />\n                <Stack direction=\"row\" spacing={1} sx={{width:\"100%\"}}>\n                    <TextField id=\"state\" placeholder=\"State\" variant=\"outlined\" onChange={handleValueChange} size=\"small\"\n                    fullWidth\n                    onFocus={()=>setConfig({...config, run:false})}\n                    onMouseLeave = {handleCommit}\n                    value = {inputValue.state}\n                    InputLabelProps={{style: { fontSize: 10 }}}\n                    InputProps={{style: { fontSize: 8 }}}\n                    />\n                    <TextField id=\"country\" placeholder=\"Country\" variant=\"outlined\" onChange={handleValueChange} size=\"small\"\n                    fullWidth\n                    onFocus={()=>setConfig({...config, run:false})}\n                    onMouseLeave = {handleCommit}\n                    value={inputValue.country}\n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    />\n                </Stack>\n                <Stack direction=\"row\" spacing={0} pl={1}>\n                    <FormControlLabel \n                        control={<Checkbox  id=\"buildings\" size='small' checked={type.buildings} onClick={handleCheck}/>}\n                        label = {<Typography variant=\"caption\">buildings</Typography>} \n                    />\n                    <FormControlLabel \n                        control={<Checkbox  id=\"roads\" size='small' checked={type.roads} onClick={handleCheck}/>}\n                        label = {<Typography variant=\"caption\">roads</Typography>} \n                    />\n                    <FormControlLabel \n                        control={<Checkbox  id=\"amenities\" size='small' checked={type.amenities} onClick={handleCheck}/>}\n                        label = {<Typography variant=\"caption\">amenities</Typography>} \n                    />\n                </Stack>\n            </Stack>\n        </List>\n    );\n}", "entrypoint": "\n#Available variables:\n# _input_: input data, e.g. input1 = _input_['input1']\n# _output_: the variable to store output data, e.g. _output_['output1'] = output1\n\n#Do something with the input\ndef main(_input_):\n    if _input_:\n        _output_ = {\n            \"output\": _input_[\"input\"]\n        }\n        print(_output_)\n        return _output_\n    else:\n        return None\n\n#Set the output\n_output_ = main(_input_)\n", "shell": "#pip install numpy"}, "containerIsRunning": false, "run": false, "state": "MA", "city": "Cambridge", "country": "United States", "icon": "data:image/png;base64,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", "time": "9/17/2024, 11:39:23 PM", "id": "fDiCVhVPu10y0O_YuBBge.", "custom": true, "expand": false, "amenities": false, "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": {}, "module": "core/builder/index.js"}, "id": "UrRB7BCD1GT-oeH3HziTx", "position": {"x": -20.57094066239779, "y": 134.5772176542912}, "width": 282, "height": 246, "selected": false, "positionAbsolute": {"x": -20.57094066239779, "y": 134.5772176542912}, "dragging": false}, {"type": "expand", "module": "builder", "version": "0.0.1", "config": {"type": "interface", "sessionID": "eVoRuX1-1V4JRHbCAYC1D", "author": "Kai Hu", "category": "gis", "title": "GeojsonEditor", "input": ["input"], "output": ["output"], "width": 500, "height": 300, "port": null, "language": "javascript", "description": "This module is useful to show and filter geojson data", "baseUrl": "", "secretKey": "", "model": "gpt-4o-mini", "packages": ["react", "@mui/material", "@mui/icons-material", "@mui/x-data-grid", "nanoid"], "code": {"interface": "\n//import packages from the scope\nimport {Typography,List, Stack,TextField ,MenuItem} from '@mui/material';\nimport {DataGrid} from \"@mui/x-data-grid\";\nimport { useEffect,useState } from 'react';\nimport * as Icon from '@mui/icons-material';\nimport {nanoid} from 'nanoid';\n\n// load necessary variables from the scope\nconst {input,config,setConfig,setOutput} = props;\n\n// Filter\nconst Filter = ({idx,columns,handleUpdateFilter,filter})=>{\n    const logicOperators = [\"AND\",\"OR\",\"NOT\"];\n    const stringOperators = [\"contains\",\"starts with\",\"ends with\"];\n    const numberOperators = [\"==\",\">=\",\">\",\"<=\",\"<\",\"!=\"];\n\n    const [value, setValue] = useState({\n        Logic: filter?.Logic||\"AND\",\n        Columns: filter?.Columns||\"\",\n        Operator: filter?.Operator||\"\",\n        Value: filter?.Value||\"\"\n    });\n    const [selectedColumn, setSelectedColumn] = useState({ \n        field: '', \n        type: 'string'\n    });\n    const handleValueChange = (e, key) => {\n        setValue({\n            ...value,\n            [key]: e.target.value\n        });\n    };\n    \n    return(\n        <>\n        {columns && columns.length>0 &&\n        <Stack direction=\"row\" spacing={1} sx={{display:\"flex\",width:\"100%\"}}>\n            <TextField id=\"Logic\" label=\"Logic\" variant=\"outlined\" size=\"small\"\n            onChange={(e)=>handleValueChange(e,\"Logic\")}\n            InputLabelProps={{style: { fontSize: 10 }}}\n            InputProps={{style: { fontSize: 8 }}}\n            value = {value.Logic}\n            sx={{width:\"100%\"}}\n            select>\n                {logicOperators.map((operator) => (\n                    <MenuItem key={operator} value={operator}>\n                    {operator}\n                    </MenuItem>\n                ))}\n            </TextField>\n            <TextField id=\"Columns\" label=\"Columns\" variant=\"outlined\" size=\"small\"\n            onChange={(e)=>{\n                handleValueChange(e,\"Columns\");\n                setSelectedColumn(columns.find(column => column.field === e.target.value));\n            }}\n            InputLabelProps={{style: { fontSize: 10 }}}\n            InputProps={{style: { fontSize: 8 }}}\n            value = {value.Columns}\n            sx={{width:\"100%\"}}\n            select>\n                {columns.map((column) => (\n                    <MenuItem key={column.field} value={column.field}>\n                    {column.field}\n                    </MenuItem>\n                ))}\n            </TextField> \n            <TextField id=\"Operator\" label=\"Operator\" variant=\"outlined\" size=\"small\"\n            onChange={(e)=>handleValueChange(e,\"Operator\")}\n            InputLabelProps={{style: { fontSize: 10 }}}\n            InputProps={{style: { fontSize: 8 }}}\n            value={value.Operator}\n            sx={{width:\"100%\"}}\n            select>\n                {selectedColumn && selectedColumn.type===\"string\"&&\n                stringOperators.map((operator) => (\n                    <MenuItem key={operator} value={operator}>\n                    {operator}\n                    </MenuItem>\n                ))}\n                {selectedColumn && selectedColumn.type===\"number\"&&\n                numberOperators.map((operator) => (\n                    <MenuItem key={operator} value={operator}>\n                    {operator}\n                    </MenuItem>\n                ))}\n            </TextField>\n            <TextField id=\"Value\" label=\"Value\" variant=\"outlined\" size=\"small\"\n            value={value.Value}\n            onChange={(e)=>{handleValueChange(e,\"Value\")}}\n            onKeyDown={(e)=>{\n                if (e.key === 'Enter') {\n                    handleUpdateFilter(idx,value);\n                }}\n            }\n            onBlur={(e)=>handleUpdateFilter(idx,value)}\n            InputLabelProps={{style: { fontSize: 10 }}}\n            InputProps={{style: { fontSize: 8 }, autoComplete: 'off'}}\n            sx={{width:\"100%\"}}\n            />\n        </Stack>\n         } \n        </>   \n    )\n}\n\n\n\n\n// main function\nexport default function GeoJsonEditor() {\n    const [columns, setColumns] = useState([]);\n    const [origRows, setOrigRows] = useState([]);\n    const [rows, setRows] = useState([]);\n    const [filteredIds, setFilteredIds] = useState([]);\n    const [filters, setFilters] = useState(config?.filters||[]);\n\n    const filterValue = {\n        \"Logic\":\"AND\",\n        \"Columns\":\"id\",\n        \"Operator\":\"\",\n        \"Value\":\"\"\n    };\n    const handleAddFilter = () => { \n        setFilters([...filters, filterValue])\n        setConfig({...config, run:false})\n    }\n    const handleDeleteFilter = () => {\n        setFilters(filters.slice(0,-1));\n    }\n    const handleUpdateFilter = (idx,newFilter) => {\n        const newFilters = filters.map((filter,i) => \n            i === idx ? \n            newFilter : filter\n        )\n        setFilters(newFilters);\n    }\n\n    // save filters to config\n    useEffect(() => {   \n        setConfig({...config,filters:filters});\n    }, [filters]);\n    \n    useEffect(() => {\n        if (!(input && input.input)) return;\n        let columns = [];\n        let rows = [];\n        const geoData = input.input;\n        if (geoData){\n            const {features} = geoData; \n            const properties = features.length>0 ? features[0].properties : {};\n            if (!(Object.keys(properties).includes(\"id\"))){\n                columns = [{field: \"id\", headerName: \"ID\", editable: false, type: 'number', width: 30}];\n            };\n            for (let key in properties) {\n                const type = typeof properties[key];\n                columns.push({\n                    field: key,\n                    headerName: key,\n                    width:70,\n                    type: type==='number'? 'number' : 'string',\n                    editable: true,\n                })\n            }\n            features.forEach((feature,idx) => {\n                const properties = feature.properties;\n                let row = {};\n                if (!(Object.keys(properties).includes(\"id\"))){\n                    row.id = idx;\n                };\n                for (let key in properties) {\n                    row[key] = properties[key];\n                }\n                rows.push(row);\n            });\n        }\n        setColumns([...columns]);\n        setRows([...rows]);\n        setOrigRows([...rows]);\n    }, [input]);\n\n    const filterRows = (filter)=>{\n        const {Columns,Operator,Value} = filter;\n        if (Columns==='' || Operator==='' || Value==='' || !origRows || columns.length===0){\n            return rows\n        };\n        const column = columns.find(column => column.field === Columns);\n        const type = column.type;\n        switch (type){\n            case \"number\":\n                return origRows.filter(row => {\n                    switch (Operator){\n                        case \"==\":\n                            return (row[Columns] == Value);\n                        case \">=\":\n                            return (row[Columns] >= Value);\n                        case \">\":\n                            return (row[Columns] > Value);\n                        case \"<=\":\n                            return (row[Columns] <= Value);\n                        case \"<\":\n                            return (row[Columns] < Value);\n                        case \"!=\":\n                            return (row[Columns] != Value);\n                    }\n                });\n            case \"string\":\n                return origRows.filter(row => {\n                    switch (Operator){\n                        case \"contains\":\n                            return JSON.stringify(row[Columns])?.includes(Value);\n                        case \"starts with\":\n                            return JSON.stringify(row[Columns])?.startsWith(Value);\n                        case \"ends with\":\n                            return JSON.stringify(row[Columns])?.endsWith(Value);\n                    }\n                });\n        }\n\n    }\n\n    useEffect(() => {\n        if (origRows.length===0) return\n        if (!filters || filters && filters.length === 0){\n            setRows(origRows);\n        }else{\n        let currentRows = [...origRows]\n        filters.forEach(filter => {\n            const {Logic} = filter;\n            const result = filterRows(filter);\n            switch (Logic){\n                case \"AND\":\n                    currentRows = result ? currentRows.filter(row => result?.includes(row)):currentRows;\n                    break;\n                case \"OR\":\n                    currentRows = result ? currentRows.concat(result):currentRows;\n                    break;\n                case \"NOT\":\n                    currentRows= result ? currentRows.filter(row => !result?.includes(row)):currentRows;\n                    break;\n            }\n        });\n        setRows(currentRows);\n        }\n    }, [filters,config.run,origRows]);\n\n    useEffect(() => {\n        if (!(input && input.input && rows.length>0 && config.run)) {\n            setOutput(null);\n            return;\n        };\n        const geoData = input.input;\n        let filteredRows = [...rows];\n        if (filteredIds && filteredIds.length>0){\n            filteredRows = rows.filter(row => filteredIds.includes(row.id))\n        };\n        const filteredFeatures = geoData.features.filter((feature,idx) => {\n            if (!(Object.keys(feature.properties).includes(\"id\"))) {\n                return filteredRows.find(row => row.id === idx);\n            }else{\n                return filteredRows.find(row => row.id === feature.properties.id);\n            }\n        });\n        setOutput({\"output\":{type:\"FeatureCollection\",features:filteredFeatures}});\n    }, [rows, config.run, input && input.input]);\n\n    return (\n        <List>\n            <Stack spacing={1} p={1} sx= {{paddingBottom:0}}>\n                {filters.map((filter,idx) => (\n                <Filter key={nanoid()} idx={idx} \n                columns={columns} \n                handleUpdateFilter={handleUpdateFilter} \n                filter={filter}\n                run = {config.run}\n                />\n                ))}\n            <Stack direction=\"row\" spacing={1} sx={{alignItems:\"right\"}}>\n                <Typography variant=\"caption\">Filters</Typography>\n                <Icon.AddCircle onClick={handleAddFilter} sx={{width:\"15px\",height:\"15px\",cursor:\"pointer\"}}/>\n                <Icon.RemoveCircle onClick={handleDeleteFilter} sx={{width:\"15px\",height:\"15px\",cursor:\"pointer\"}}/>\n            </Stack>\n            </Stack>\n            <Stack p={1}>\n            <DataGrid\n                rowHeight={20}\n                columnHeaderHeight = {30}\n                columnBufferPx ={50}\n                rows={rows}\n                columns={columns}\n                size=\"small\"\n                initialState={{\n                    pagination: {\n                        paginationModel: { page: 0, pageSize: 20 },\n                    },\n                    }}\n                pageSizeOptions={[20, 40]}\n                checkboxSelection\n                disableColumnFilter\n                onRowSelectionModelChange={(ids) => {setFilteredIds(ids)}}\n                processRowUpdate={(newRow, oldRow) => {setRows(rows.map(row => row.id === oldRow.id ? newRow : row));return newRow}}\n                onProcessRowUpdateError={(error, newRow, oldRow) => {console.log(error)}}\n                editMode='cell'\n                sx={{\n                    \"& .MuiDataGrid-footerContainer\":{\n                        height:30,\n                        minHeight:30\n                    },\n                    \"& .MuiDataGrid-scrollbar\":{\n                        display:\"none\"\n                    }\n                }}\n            />\n            </Stack>\n        </List>\n    );\n}", "entrypoint": "\n#Available variables:\n# _input_: input data, e.g. input1 = _input_['input1']\n# _output_: the variable to store output data, e.g. _output_['output1'] = output1\n\n#Do something with the input\ndef main(_input_):\n    if _input_:\n        _output_ = {\n            \"output\": _input_[\"input\"]\n        }\n        print(_output_)\n        return _output_\n    else:\n        return None\n\n#Set the output\n_output_ = main(_input_)\n", "shell": "#pip install numpy"}, "containerIsRunning": false, "filters": [], "icon": "data:image/png;base64,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", "time": "9/15/2024, 5:48:00 PM", "id": "eVoRuX1-1V4JRHbCAYC1D.", "custom": true, "expand": false, "run": false, "scope": {}}, "entrypoint": "index.js", "data": {"input": {}, "output": null, "module": "core/builder/index.js"}, "id": "2EgLEu82-fQ0oYU_39d50", "position": {"x": 360.473916491655, "y": 350.14848975825794}, "width": 532, "height": 384, "selected": false, "positionAbsolute": {"x": 360.473916491655, "y": 350.14848975825794}, "dragging": false}, {"type": "expand", "module": "builder", "version": "0.0.1", "config": {"type": "interface", "sessionID": "dZh5vC16MnOXAFERk5yld", "author": "Kai Hu", "category": "gis", "title": "GridCreator", "input": ["boundary", "geoData"], "output": ["grid"], "width": 200, "height": 140, "port": null, "language": "javascript", "description": "this module is useful for converting geojson to grid data", "baseUrl": "", "secretKey": "", "model": "gpt-4o-mini", "packages": ["react", "@mui/material", "@turf/turf"], "code": {"interface": "\n//import packages from the scope\nimport {Stack,MenuItem,TextField} from '@mui/material';\nimport { useEffect,useState} from 'react';\nimport * as turf from '@turf/turf';\n\n// load necessary variables from the scope\nconst {input,config,setConfig,setOutput} = props;\n\n// main function\nexport default function GridCreator() {\n    const [gridType, setGridType] = useState(config.gridType || \"hexGrid\");\n    const [gridSize, setGridSize] = useState(config.gridSize || 100);\n    const [aggInfo, setAggInfo] = useState({\n        \"property\": config.aggInfo?.property || \"id\",\n        \"method\":  config.aggInfo?.method || \"none\"\n    })\n    const aggOperators = [\"count\",\"sum\",\"avg\",\"min\",\"max\",\"none\"];\n    useEffect(() => {\n        if (config.run && input && input.boundary) {\n            let grid;\n            grid = createGrid(input.boundary);\n            if (input.geoData){\n                grid = aggGrid(grid,input.geoData)\n            }\n            setOutput({grid})\n        } else {\n            setOutput({grid:null});\n        }\n    }, [config.run,input,gridType,gridSize,aggInfo.property,aggInfo.method]);\n\n    // save values to config\n    useEffect(() => {\n        setConfig({...config,gridType,gridSize,aggInfo});\n    }, [gridType,gridSize,aggInfo]);\n\n    const createGrid = (boundary) => {\n        let grid = null;\n        try {\n            const bbox = turf.bbox(boundary);\n            //create grid\n            switch (gridType) {\n                case \"hexGrid\":\n                    grid = turf.hexGrid(bbox,gridSize/1000);\n                    break;\n                case \"squareGrid\":\n                    grid = turf.squareGrid(bbox,gridSize/1000);\n                    break;\n                case \"triangleGrid\":\n                    grid = turf.triangleGrid(bbox,gridSize/1000);\n                    break;\n                default:\n                    break;\n            }\n            } catch (error) {\n                console.log(error);\n                return;\n        }\n        return grid;\n    }\n\n    const aggGrid = (grid,geoData) => {\n        // filter the grid outsize the hull polygon\n        if (aggInfo.property){\n            const hull = turf.convex(geoData);\n            grid.features  = grid.features.filter((feature) => turf.booleanPointInPolygon(turf.centroid(feature),hull));\n            const {property, method} = aggInfo;\n            //Convert geoData to Point\n            geoData.features = geoData.features.map((feature) => {\n                if (feature.geometry.type === \"Point\") return feature;\n                const point = turf.centerOfMass(feature.geometry);\n                feature.geometry = point.geometry;\n                feature.type = \"Point\"\n                return feature;\n            });\n            // Collect the points in each grid\n            let collection = turf.collect(grid, geoData, property, `${property}_${method}`);\n            // Aggregate the property in each grid\n            let aggFeatures = [];\n            switch (method) {\n                case \"count\":\n                    aggFeatures = collection.features.map((feature) => {\n                        feature.properties[`${property}_${method}`] = feature.properties[`${property}_${method}`].length;\n                        feature.properties['color'] = feature.properties[`${property}_${method}`] ? [255,0,0,200]:[120, 165, 120, 150]\n                        return feature;\n                    });\n                    break;\n                case \"sum\":\n                    aggFeatures = collection.features.map((feature) => {\n                        feature.properties[`${property}_${method}`] = feature.properties[`${property}_${method}`].reduce((a,b) => a+b,0);\n                        feature.properties['color'] = feature.properties[`${property}_${method}`] ? [255,0,0,200]:[120, 165, 120, 150]\n                        return feature;\n                    });\n                    break;\n                case \"avg\":\n                    aggFeatures = collection.features.map((feature) => {\n                        const numFeatures = feature.properties[`${property}_${method}`].length;\n                        if (numFeatures>0){\n                            const sum = feature.properties[`${property}_${method}`].reduce((a,b) => a+b,0);\n                            feature.properties[`${property}_${method}`] = sum/numFeatures;\n                        } else {\n                            feature.properties[`${property}_${method}`] = 0;\n                        }\n                        feature.properties['color'] = feature.properties[`${property}_${method}`] ? [255,0,0,200]:[120, 165, 120, 150]\n                        return feature;\n                    });\n                    break;\n                case \"min\":\n                    aggFeatures = collection.features.map((feature) => {\n                        feature.properties[`${property}_${method}`] = Math.min(...feature.properties[`${property}_${method}`]);\n                        feature.properties['color'] = feature.properties[`${property}_${method}`] ? [255,0,0,200]:[120, 165, 120, 150]\n                        return feature;\n                    });\n                    break;\n                case \"max\":\n                    aggFeatures = collection.features.map((feature) => {\n                        feature.properties[`${property}_${method}`] = Math.max(...feature.properties[`${property}_${method}`]);\n                        feature.properties['color'] = feature.properties[`${property}_${method}`] ? [255,0,0,200]:[120, 165, 120, 150]\n                        return feature;\n                    });\n                    break;\n                case \"none\":\n                    aggFeatures = collection.features.map((feature) => {\n                        feature.properties['color'] = [120, 165, 120, 150]\n                        return feature;\n                    });\n                    break;\n                default:\n                    aggFeatures = collection.features\n                    break;\n            }\n            grid.features = aggFeatures;\n        }\n        grid.properties = {\n            \"gridType\": gridType, \n            \"gridSize\": gridSize,\n            \"lineColor\":[255, 255, 255, 200],\n            \"lineWidth\": 500, \n            \"stroked\" : true,\n            \"wireframe\": true,\n        };\n        return grid;\n    }\n\n\n    const handleTypeChange = (e) => {\n        setGridType(e.target.value);\n    }\n    const handleValueChange = (e) => {\n        setGridSize(e.target.value);\n    }\n    const handleAggChange = (e,key) => {\n        const newAggInfo = {...aggInfo, [key]: e.target.value};\n        setAggInfo(newAggInfo);\n    }\n\n    return (\n        <>\n        <Stack spacing={1.2} sx={{p:1, paddingTop:2}}>\n            <Stack direction=\"row\" spacing={1}>\n                <TextField fullWidth label=\"Grid Type\" value={gridType} size=\"small\"\n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    onChange={handleTypeChange}\n                    select>\n                    <MenuItem value=\"hexGrid\">hexGrid</MenuItem>\n                    <MenuItem value=\"squareGrid\">squareGrid</MenuItem>\n                    <MenuItem value=\"triangleGrid\">triangleGrid</MenuItem>\n                </TextField>\n                <TextField label=\"Grid Size(m)\" type=\"number\" value={gridSize} size=\"small\" \n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    onChange={handleValueChange}\n                    >\n                </TextField>\n            </Stack>\n            {input && input.geoData && input.geoData.features[0] && \n            (<TextField label=\"Aggregate Property\" size=\"small\" \n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    onChange={(e)=>{handleAggChange(e,\"property\")}}\n                    value = {aggInfo?.property||\"\"}\n                    select\n                    >\n                    {Object.keys(input.geoData.features[0].properties).map((property) => (\n                        <MenuItem key={property} value={property}>\n                        {property}\n                        </MenuItem>\n                    )) || <MenuItem value={\"\"}>No Properties</MenuItem>\n                    }\n            </TextField>) \n            || <TextField label=\"Aggregate Property\" size=\"small\" \n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    disabled = {true}\n                />\n            }\n            <TextField fullWidth label=\"Aggregate Method\" size=\"small\"\n                    value = {aggInfo?.method || \"count\"}\n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    onChange={(e)=>{handleAggChange(e,\"method\")}}\n                    select>\n                    {aggOperators.map((operator) => (\n                        <MenuItem key={operator} value={operator}>\n                        {operator}\n                        </MenuItem>\n                    ))}\n            </TextField>\n        </Stack>\n        </>\n    );\n}", "entrypoint": "\n#Available variables:\n# _input_: input data, e.g. input1 = _input_['input1']\n# _output_: the variable to store output data, e.g. _output_['output1'] = output1\n\n#Do something with the input\ndef main(_input_):\n    if _input_:\n        _output_ = {\n            \"output\": _input_[\"input\"]\n        }\n        print(_output_)\n        return _output_\n    else:\n        return None\n\n#Set the output\n_output_ = main(_input_)\n", "shell": "#pip install numpy"}, "containerIsRunning": false, "gridType": "hexGrid", "gridSize": "100", "aggInfo": {"property": "id", "method": "count"}, "run": false, "icon": "data:image/png;base64,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", "time": "9/18/2024, 11:20:28 AM", "id": "dZh5vC16MnOXAFERk5yld.", "custom": true, "expand": false, "scope": {}}, "entrypoint": "index.js", "data": {"input": {}, "output": {}, "module": "core/builder/index.js"}, "id": "tc7_3eoj_hvdXrgKhg4ev", "position": {"x": 988.6538644828902, "y": 169.0702180308065}, "width": 232, "height": 240, "selected": false, "positionAbsolute": {"x": 988.6538644828902, "y": 169.0702180308065}, "dragging": false}, {"type": "expand", "module": "builder", "version": "0.0.1", "config": {"type": "interface", "sessionID": "JQv4VQ1Mm0widtIlBD0n0", "author": "Kai Hu", "category": "gis", "title": "Mapping", "input": ["geojson"], "output": ["geojson"], "width": 200, "height": 230, "port": null, "language": "javascript", "description": "this module is useful for mapping the data to color", "baseUrl": "", "secretKey": "", "model": "gpt-4o-mini", "packages": ["react", "@mui/material", "d3"], "code": {"interface": "\n//import packages from the scope\nimport { TextField,MenuItem,Stack} from \"@mui/material\";\nimport { useEffect, useState } from \"react\";\nimport * as d3 from 'd3';\n\nfunction rgbToHex(r, g, b) {\n    function valToHex(c) {\n      var hex = c.toString(16);\n      return hex.length === 1 ? \"0\" + hex : hex;\n    }\n    return \"#\" + valToHex(r) + valToHex(g) + valToHex(b);\n  }\n  \n/**\n * convert hex to rgb array\n */\nfunction hexToRgb(hex) {\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result\n    ? [\n        parseInt(result[1], 16),\n        parseInt(result[2], 16),\n        parseInt(result[3], 16),\n      ]\n    : null;\n}\n\n/**\n * convert rgb string to array\n */\n\nfunction rgbToArray(rgb) {\n  var result = rgb.replace(/[^\\d,]/g, \"\").split(\",\");\n  return result\n    ? [\n      parseInt(result[0], 16),\n      parseInt(result[1], 16),\n      parseInt(result[2], 16),\n    ]\n  : null;\n}\n\n// load necessary variables from the scope\nconst {input,config,setConfig,setOutput} = props;\n\n// main function\nexport default function Item() {\n    const [range,setRange] = useState({\n        min: 0,\n        max: 1\n    });\n    \n    const [values,setValues] = useState({\n        option: config.option || \"color\",\n        property: config.property || \"\",\n        dataType: config.dataType || \"\",\n        numCategories: config.numCategories || 10,\n        colorScheme: config.colorScheme || \"\",\n        dataRange: config.dataRange || [0,1]\n    });\n\n    const handleValueChange = (e,k) => {\n        setValues({...values,[k]: e.target.value})\n        setConfig({...config,[k]: e.target.value});\n    }\n    const handleRangeChange = (e,k) => {\n        setRange({...range,[k]: e.target.value})\n        if (k === \"min\") {\n            setValues({...values,dataRange: [e.target.value,range.max]})\n            setConfig({...config,dataRange: [e.target.value,range.max]});\n        }else{\n            setValues({...values,dataRange: [range.min,e.target.value]})\n            setConfig({...config,dataRange: [range.min,e.target.value]});\n        }\n    }\n\n    const itemList = [\"color\",\"lineColor\",\"pointRadius\",\"lineWidth\",\"height\"]\n\n    const linearSchemes = [\"interpolateRdBu\",\"interpolatePuOr\",\"interpolateSpectral\",\"interpolatePiYG\"];\n\n    const ordinalSchemes = [\"schemeRdYlBu\",\"schemeRdBu\",\"schemeSpectral\",\"schemeBrBG\"];\n\n    const mappingValue = (v) => {\n        if (!(input && input.geojson)) return\n        let scale;\n        let data = [];\n        input.geojson.features.forEach(d => {\n            data.push(d.properties[values.property]);\n        });\n        if (values.option ===\"color\" || values.option === \"lineColor\") {\n            if (!(values.colorScheme && values.dataType && d3[values.colorScheme])) return v;\n            if (values.dataType === \"continuous\" && d3[values.colorScheme](1)) {\n                scale = d3.scaleLinear()\n                    .domain(d3.extent(data))\n                    .range([d3[values.colorScheme](0),d3[values.colorScheme](1)])\n                return scale(v) && rgbToArray(scale(v));\n            }else if (d3[values.colorScheme][values.numCategories]){\n                scale = d3.scaleOrdinal()\n                    .domain([...new Set(data)])\n                    .range(d3[values.colorScheme][values.numCategories])\n            return hexToRgb(scale(v));\n            }\n        }else {\n            if (values.dataType === \"continuous\") {\n                scale = d3.scaleLinear()\n                .domain(d3.extent(data))\n                .range([parseFloat(range.min),parseFloat(range.max)])\n                return scale(v);\n            }else{\n                const min = parseFloat(range.min);\n                const max = parseFloat(range.max);\n                const stepSize = (max - min) / values.numCategories;\n                const discreteRange = Array.from({length: values.numCategories}, (_, i) => min + i * stepSize);\n                scale = d3.scaleOrdinal()\n                .domain([...new Set(data)].sort(d3.ascending))\n                .range(discreteRange)\n                return scale(v);\n            }\n        }\n    }\n\n    useEffect(() => {\n        if (config.run && input && input.geojson) {\n            const newData = {...input.geojson,\n                features: input.geojson.features.map((d) => {\n                    return {\n                        ...d,\n                        properties: {\n                            ...d.properties,\n                            [values.option]: mappingValue(d.properties[values.property])\n                        }\n                    }\n                })\n            }\n            setOutput({geojson:newData});\n        } else {\n            setOutput({geojson:null});\n        }\n    }, [config.run,input,values]);\n\n    return (\n        <>\n        <Stack spacing={1} sx={{p:1}}>\n        {input && input.geojson && input.geojson.features[0] && \n            (<TextField fullWidth label=\"Aggregate Property\" size=\"small\" \n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    onChange={(e)=>{handleValueChange(e,\"property\")}}\n                    value = {values.property}\n                    select\n                    >\n                    {\n                    Object.keys(input.geojson.features[0].properties).map((property) => (\n                        <MenuItem key={property} value={property}>\n                        {property}\n                        </MenuItem>\n                    )) || <MenuItem value={\"\"}>No Properties</MenuItem>\n                    }\n            </TextField>) \n            || <TextField fullWidth label=\"Aggregate Property\" size=\"small\" \n                    InputLabelProps={{style: { fontSize: 8 }}}\n                    InputProps={{style: { fontSize: 8}}}\n                    disabled = {true}\n                />\n        }\n        <Stack spacing={1}>\n        <TextField fullWidth label=\"Options\" size=\"small\" select\n            InputLabelProps={{style: { fontSize: 8 }}}\n            InputProps={{style: { fontSize: 8}}}\n            onChange={(e)=>{handleValueChange(e,\"option\")}}\n            value={values.option}>\n            {itemList.map((item) => (\n                <MenuItem key={item} value={item}>\n                    {item}\n                </MenuItem>\n            ))}\n        </TextField>\n        {\n        <TextField fullWidth label=\"Data Type\" size=\"small\" select\n        InputLabelProps={{style: { fontSize: 8 }}}\n        InputProps={{style: { fontSize: 8}}}\n        onChange={(e)=>{handleValueChange(e,\"dataType\")}}\n        value={values.dataType}>\n            <MenuItem value=\"continuous\">Continuous</MenuItem>\n            <MenuItem value=\"discrete\">Discrete</MenuItem>\n        </TextField>\n        }\n        {\n        values.dataType === \"discrete\" &&\n        <TextField fullWidth label=\"Number of Categories\" size=\"small\"\n            InputLabelProps={{style: { fontSize: 8 }}} select\n            InputProps={{style: { fontSize: 8}}}\n            onChange={(e)=>{handleValueChange(e,\"numCategories\")}}\n            value={values.numCategories}\n            >\n            {\n                Array.from({length: 8}, (_, i) => (\n                    <MenuItem key={i+2} value={i+3}>\n                        {i+3}\n                    </MenuItem>\n                ))\n            }\n        </TextField>\n        }\n        {\n        (values.option === \"color\" || values.option === \"lineColor\") &&\n        (<TextField fullWidth label=\"Data Range\" size=\"small\" select\n            InputLabelProps={{style: { fontSize: 8 }}}\n            InputProps={{style: { fontSize: 8}}}\n            onChange={(e)=>{handleValueChange(e,\"colorScheme\")}}\n            value={values.colorScheme}>\n                {\n                    values.dataType === \"continuous\" && linearSchemes.map((scheme) => (\n                        <MenuItem key={scheme} value={scheme}>\n                            <div style={{ width: config.width, height: 10}}>\n                            {Array.from({ length: 100 }, (_, i) => (\n                                <div\n                                    key={i}\n                                    style={{\n                                        width: config.width/100,\n                                        height: 10,\n                                        backgroundColor: d3[scheme](i/100),\n                                        display: 'inline-block',\n                                    }}\n                                />\n                            ))}\n                            </div>\n                        </MenuItem>\n                    ))\n                }\n                {\n                    (values.dataType === \"discrete\" && values.numCategories) && ordinalSchemes.map((scheme) => (\n                        <MenuItem key={scheme} value={scheme} sx={{display:\"felx\", alignItems:\"center\"}}>\n                            <div style={{ width: config.width, height: 10}}>\n                                {d3[scheme][values.numCategories].map((c) => (\n                                <div\n                                    key={c}\n                                    style={{\n                                    width: config.width/values.numCategories,\n                                    height: 10,\n                                    backgroundColor: c,\n                                    display: 'inline-block',\n                                    }}\n                                />\n                                ))}\n                            </div>\n                        </MenuItem>\n                    ))\n                \n                }\n        </TextField>)\n        || (\n            <>\n            <TextField fullWidth label=\"Min\" size=\"small\"\n                InputLabelProps={{style: { fontSize: 8 }}}\n                InputProps={{style: { fontSize: 8}}}\n                onChange = {(e)=>handleRangeChange(e,\"min\")}\n                value={range.min}\n                type=\"number\"\n            />\n            <TextField fullWidth label=\"Max\" size=\"small\" \n                InputLabelProps={{style: { fontSize: 8 }}}\n                InputProps={{style: { fontSize: 8}}}\n                onChange = {(e)=>handleRangeChange(e,\"max\")}\n                value={range.max}\n                type=\"number\"\n            />\n            </>\n        )\n        }\n        </Stack>\n        </Stack>\n        </>\n    )\n}\n", "entrypoint": "\n#Available variables:\n# _input_: input data, e.g. input1 = _input_['input1']\n# _output_: the variable to store output data, e.g. _output_['output1'] = output1\n\n#Do something with the input\ndef main(_input_):\n    if _input_:\n        _output_ = {\n            \"output\": _input_[\"input\"]\n        }\n        print(_output_)\n        return _output_\n    else:\n        return None\n\n#Set the output\n_output_ = main(_input_)\n", "shell": "#pip install numpy"}, "containerIsRunning": false, "property": "id_count", "dataType": "continuous", "colorScheme": "interpolatePuOr", "run": false, "time": "9/15/2024, 6:37:55 PM", "option": "color", "icon": "data:image/png;base64,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", "id": "JQv4VQ1Mm0widtIlBD0n0.", "custom": true, "expand": false, "scope": {}}, "entrypoint": "index.js", "data": {"input": {}, "output": {}, "module": "core/builder/index.js"}, "id": "wodtHxyte0NanDoUwb4ZY", "position": {"x": 1279.8983389024977, "y": 182.1089412299415}, "width": 232, "height": 314, "selected": false, "positionAbsolute": {"x": 1279.8983389024977, "y": 182.1089412299415}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 731, "height": 76, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "# Amenity Density in Cambridge", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "sIEfEX7pBDWV8lB6zjJIG", "position": {"x": 1015.8778537652067, "y": -271.66657593032386}, "width": 731, "height": 76, "selected": false, "positionAbsolute": {"x": 1015.8778537652067, "y": -271.66657593032386}, "dragging": false, "resizing": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "### Download data from OSM ", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "s6AmVZQqfCRb4MPHQqYwh", "position": {"x": -7.049006944387088, "y": 44.20181590141588}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": -7.049006944387088, "y": 44.20181590141588}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "### Filter the type of Amenity", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "MNEoayTFFzijskWR0WNnh", "position": {"x": 376.4190248384083, "y": 269.88873044024854}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": 376.4190248384083, "y": 269.88873044024854}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "### Create Aggegate Map", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "TkCbDd_30SoA_LMWPGMeT", "position": {"x": 993.5628884888442, "y": 78.15471454885088}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": 993.5628884888442, "y": 78.15471454885088}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "### Mapping density to color", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "aXpLLiXUl_EaC_IwrKZPF", "position": {"x": 1301.1362056479618, "y": 84.14640254545705}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": 1301.1362056479618, "y": 84.14640254545705}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "### Visualization", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "GL99xpKaEQ1FAX-hp5m9p", "position": {"x": 1636.6707334579078, "y": 40.20735723701177}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": 1636.6707334579078, "y": 40.20735723701177}, "dragging": false}, {"type": "annotation", "module": "shape", "version": "0.0.1", "config": {"title": "Shape", "discription": "this module is useful for drawing an rectangle/triangle/circle", "author": "Kai Hu", "width": 614, "height": 147, "icon": "/_next/static/media/shapes.7f3edb04.png", "run": false, "rect": true, "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/shape/index.js"}, "id": "nzLwbkaIWYwuYTLbA4JU5", "position": {"x": 981.6149687735967, "y": -295.3163546337608}, "width": 614, "height": 147, "selected": false, "positionAbsolute": {"x": 981.6149687735967, "y": -295.3163546337608}, "dragging": false, "resizing": false}, {"type": "annotation", "module": "arrow", "version": "0.0.1", "config": {"title": "Arrow", "discription": "this module is useful for drawing an arrow", "author": "Kai Hu", "width": 100, "height": 100, "icon": "/_next/static/media/arrow.863bd9fb.png", "run": false, "rotate": 284.39225457521394, "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/arrow/index.js"}, "id": "pLcbEDni04k_SFJm5Ycor", "position": {"x": -103.94428789717483, "y": 308.24734445853414}, "width": 100, "height": 100, "selected": false, "positionAbsolute": {"x": -103.94428789717483, "y": 308.24734445853414}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "setting the location", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "IXfsZTxi5M0xXrfKAcnSf", "position": {"x": -209.40716246052693, "y": 405.50916070798075}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": -209.40716246052693, "y": 405.50916070798075}, "dragging": false}, {"type": "annotation", "module": "arrow", "version": "0.0.1", "config": {"title": "Arrow", "discription": "this module is useful for drawing an arrow", "author": "Kai Hu", "width": 100, "height": 100, "icon": "/_next/static/media/arrow.863bd9fb.png", "run": false, "rotate": 91.12013611295308, "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/arrow/index.js"}, "id": "n5ydu6YaBO_ZZXn1UftpW", "position": {"x": 286.1050519171463, "y": 439.98348587129925}, "width": 100, "height": 100, "selected": false, "positionAbsolute": {"x": 286.1050519171463, "y": 439.98348587129925}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "Add filters", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "dvxOtuQ4l318WCRLolqPs", "position": {"x": 235.73005185515547, "y": 527.2673685330174}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": 235.73005185515547, "y": 527.2673685330174}, "dragging": false}, {"type": "annotation", "module": "arrow", "version": "0.0.1", "config": {"title": "Arrow", "discription": "this module is useful for drawing an arrow", "author": "Kai Hu", "width": 100, "height": 100, "icon": "/_next/static/media/arrow.863bd9fb.png", "run": false, "controlX": 26, "controlY": 60, "rotate": 28.789260670368623, "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/arrow/index.js"}, "id": "wovPDb3IEhFVJf8-GwkXt", "position": {"x": 1024.0083493173415, "y": 395.5057345095416}, "width": 100, "height": 100, "selected": false, "positionAbsolute": {"x": 1024.0083493173415, "y": 395.5057345095416}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "Change aggregate methods if you like", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "_uWSUcDPG8wbW3rPKEszz", "position": {"x": 968.3832370637438, "y": 498.6235350496532}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": 968.3832370637438, "y": 498.6235350496532}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "Change different color mapping", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "R0X65k7fNDBxnNbJWyjWy", "position": {"x": 1308.8861185030987, "y": 500.1941370581361}, "width": 300, "height": 50, "selected": false, "positionAbsolute": {"x": 1308.8861185030987, "y": 500.1941370581361}, "dragging": false}, {"type": "annotation", "module": "text", "version": "0.0.1", "config": {"title": "Text", "discription": "this module is useful for adding text to the workspace", "author": "Kai Hu", "width": 300, "height": 50, "icon": "/_next/static/media/text.ce9d4a2f.png", "run": false, "value": "# Click Here for Demonstration !", "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/text/index.js"}, "id": "tqpLvQIGww4jxJBiHYfmc", "position": {"x": 2259.9038098323927, "y": 1256.4433281326928}, "width": 300, "height": 50, "selected": false, "dragging": false, "positionAbsolute": {"x": 2259.9038098323927, "y": 1256.4433281326928}}, {"type": "annotation", "module": "arrow", "version": "0.0.1", "config": {"title": "Arrow", "discription": "this module is useful for drawing an arrow", "author": "Kai Hu", "width": 100, "height": 100, "icon": "/_next/static/media/arrow.863bd9fb.png", "run": false, "scope": {}}, "entrypoint": "index.js", "data": {"input": null, "output": null, "module": "annotation/arrow/index.js"}, "id": "fBzfDwrnqK0LgmLa-O6KU", "position": {"x": 2495.8112711207086, "y": 1459.5029150644082}, "width": 100, "height": 100, "selected": false, "positionAbsolute": {"x": 2495.8112711207086, "y": 1459.5029150644082}, "dragging": false}, {"type": "expand", "module": "builder", "version": "0.0.1", "config": {"type": "interface", "sessionID": "JF5f8wIsPemc3MFwlgdb2", "author": "Kai Hu", "category": "gis", "title": "GeoJson Map", "input": ["input"], "output": [""], "width": 1200, "height": 800, "port": null, "language": "javascript", "description": "No description", "baseUrl": "http://localhost:11434", "secretKey": "", "model": "llama3:instruct", "packages": ["react", "@mui/material", "@deck.gl/react", "@deck.gl/core", "@deck.gl/layers", "@turf/turf", "lodash", "mapbox-gl/dist/mapbox-gl.css", "nanoid", "deck.gl", "react-map-gl", "@deck.gl/geo-layers", "constants"], "code": {"interface": "import {GeoJsonLayer,BitmapLayer} from '@deck.gl/layers';\nimport {TileLayer} from '@deck.gl/geo-layers';\nimport {nanoid} from 'nanoid';\nimport { useEffect, useState, useRef} from \"react\";\nimport DeckGL from \"@deck.gl/react\";\nimport \"mapbox-gl/dist/mapbox-gl.css\";\nimport { TextField,MenuItem,Box,Stack} from \"@mui/material\";\nimport { MapController,WebMercatorViewport } from \"@deck.gl/core\";\nimport {mapboxToken} from 'constants'\n\nimport * as turf from '@turf/turf'\n\nconst {input,config,setConfig,setOutput} = props\n\nexport default function GeoJsonBaseLayer({data, opacity}){\n    if(data){\n        return new GeoJsonLayer({\n          id: nanoid(),\n          data: data,\n          opacity: opacity || 0.5,\n          pickable: data.properties?.pickable || true,\n          stroked: data.properties?.stroked || false,\n          filled: data.properties?.filled || true,\n          extruded: data.properties?.extruded || true,\n          wireframe: data.properties?.wireframe || false,\n          pointType: data.properties?.pointType || 'circle',\n          autoHighlight: data.properties?.autoHighlight || true,\n          highlightColor: data.properties?.highlightColor || [242, 0, 117, 120],\n          lineWidthUnits: data.properties?.lineWidthUnits || 'pixels',\n          lineWidthMinPixels: data.properties?.lineWidthMinPixels || 1,\n          getFillColor: d => d.properties?.color || data.properties?.color ||  [255, 0, 0],\n          getLineColor: d => d.properties?.lineColor || data.properties?.lineColor || [255, 255, 255],\n          getPointRadius: d =>   d.properties?.pointRadius || data.properties?.pointRadius || 10,\n          getLineWidth: d => d.properties?.lineWidth ||data.properties?.lineWidth ||  1,\n          getElevation: d => d.properties?.height || data.properties?.height || 1,\n          updateTriggers: {\n            getFillColor: data,\n            getLineColor: data,\n            getPointRadius: data,\n            getLineWidth: data,\n            getElevation: data,\n          },\n          transitions: {\n            getFillColor: data.properties?.duration || 500,\n            getElevation: data.properties?.duration || 500,\n            getLineWidth: data.properties?.duration || 500,\n            getPointRadius: data.properties?.duration || 500,\n            getLineColor: data.properties?.duration || 500,\n          }\n        });\n      \n      \n    }\n  }\n\nexport default function TileBaseLayer() {\n  const mapStyle = {\n    Dark: 'cjs9rb33k2pix1fo833uweyjd',\n    Light: 'ck0h5xn701bpr1dqs3he2lecq',\n    Inverse: 'cjlu6w5sc1dy12rmn4kl2zljn',\n    Normal: 'cl8dv36nv000t14qik9yg4ys6',\n  };\n  return new TileLayer({\n    data:\n      `https://api.mapbox.com/styles/v1/relnox/${mapStyle.Dark}/tiles/256/{z}/{x}/{y}?access_token=` + mapboxToken +\n      '&attribution=false&logo=false&fresh=true',\n    minZoom: 0,\n    maxZoom: 21,\n    tileSize: 256,\n    id: 'MapboxTile',\n    renderSubLayers: (props) => {\n      const {\n        bbox: { west, south, east, north },\n      } = props.tile;\n\n      return new BitmapLayer(props, {\n        data: null,\n        image: props.data,\n        bounds: [west, south, east, north],\n      });\n    },\n  });\n}\n\nexport default function DeckGLMap() {\n    const deckGLref = useRef(null);\n    const [layers, setLayers] = useState([]);\n    const [viewState, setViewState] = useState({\n        latitude: 42.3654825444308, \n        longitude: -71.09032464941119,\n        zoom:  15,\n        pitch: 0,\n        bearing: 0,\n        minZoom: 10,\n        maxZoom: 22,\n    });\n    const [bbox, setBbox] = useState(null);\n\n    const onBeforeRender = () => {\n        const layer = layers[0];\n        // fit the bounds of the layer\n        if (layer && layer.isLoaded && bbox) {\n            const viewport = layer.context.viewport;\n            // fitBounds - Bounding box in [[longitude, latitude], [longitude, latitude]] format\n            const formatedBounds = [[bbox[0], bbox[1]], [bbox[2], bbox[3]]];\n            const {longitude, latitude, zoom} = viewport.fitBounds(formatedBounds);\n            if (!(longitude === config.longtitude && latitude === config.latitude && zoom === config.zoom )){\n            setViewState({...viewState,longitude, latitude, zoom:zoom-1});\n            }\n        }\n    }\n\n    useEffect(() => {\n      if (!(input&&input.input)) return \n      const data = input.input;\n      setBbox(turf.bbox(data));\n      setLayers([TileBaseLayer(), GeoJsonBaseLayer({ data:data, opacity: 0.5 })]);\n    }, [input]);\n    \n    return (\n        <>\n        {input && input.input &&\n        <Box style={{width:config?.width, height:config?.height, position: 'relative', margin:0,padding:0}}>\n            <DeckGL\n            ref={deckGLref}\n            initialViewState={viewState}\n            onContextMenu={(e) => e.preventDefault()}\n            onBeforeRender={onBeforeRender}\n            layers={layers}\n            controller={{\n                type: MapController,\n                dragRotate: true,\n                dragPan: true,\n                scrollZoom: true,\n                touchZoom: true,\n                touchRotate: true,\n                keyboard: true,\n                doubleClickZoom: true\n            }}\n            >\n            </DeckGL>\n        </Box>\n        }\n        </>\n    );\n}\n"}, "containerIsRunning": false, "run": false, "time": "9/18/2024, 3:04:58 PM", "icon": "data:image/png;base64,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", "id": "JF5f8wIsPemc3MFwlgdb2.", "custom": true, "expand": false, "pin": true, "scope": {}}, "entrypoint": "index.js", "data": {"input": {}, "output": null, "module": "core/builder/index.js"}, "id": "ndexdvPQId82il79VyOPf", "position": {"x": 1664.5769372471157, "y": 93.25976976104693}, "width": 1232, "height": 884, "positionAbsolute": {"x": 1664.5769372471157, "y": 93.25976976104693}, "dragging": false, "selected": true}], "edges": [{"id": "v4anic", "source": "UrRB7BCD1GT-oeH3HziTx", "sourceHandle": "UrRB7BCD1GT-oeH3HziTx||amenities", "target": "2EgLEu82-fQ0oYU_39d50", "targetHandle": "2EgLEu82-fQ0oYU_39d50||input", "type": "base"}, {"id": "mTmL2Y", "source": "UrRB7BCD1GT-oeH3HziTx", "sourceHandle": "UrRB7BCD1GT-oeH3HziTx||amenities", "target": "tc7_3eoj_hvdXrgKhg4ev", "targetHandle": "tc7_3eoj_hvdXrgKhg4ev||boundary", "type": "base"}, {"id": "G4J_WZ", "source": "2EgLEu82-fQ0oYU_39d50", "sourceHandle": "2EgLEu82-fQ0oYU_39d50||output", "target": "tc7_3eoj_hvdXrgKhg4ev", "targetHandle": "tc7_3eoj_hvdXrgKhg4ev||geoData", "type": "base"}, {"id": "L1JIQi", "source": "tc7_3eoj_hvdXrgKhg4ev", "sourceHandle": "tc7_3eoj_hvdXrgKhg4ev||grid", "target": "wodtHxyte0NanDoUwb4ZY", "targetHandle": "wodtHxyte0NanDoUwb4ZY||geojson", "type": "base"}, {"id": "jJ2uAk", "source": "wodtHxyte0NanDoUwb4ZY", "sourceHandle": "wodtHxyte0NanDoUwb4ZY||geojson", "target": "ndexdvPQId82il79VyOPf", "targetHandle": "ndexdvPQId82il79VyOPf||input", "type": "base"}], "viewport": {"x": 83.41345522519475, "y": 237.2464113441137, "zoom": 0.3471674296916973}, "flowId": "8h3Mvo_LA-FQmWj2KbLCq"}